# build.zip ì••ì¶• ë°©ì‹ ë° ìƒì„± íŒ¨í„´ ê°œì„  ê²°ê³¼ ë³´ê³ ì„œ

## ğŸ“Œ ë¬¸ì œ ìƒí™© ìš”ì•½

GitHub Actions ì›Œí¬í”Œë¡œìš°ì—ì„œ Azure App Service ë°°í¬ ì‹œ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:

1. `build.zip` íŒŒì¼ì´ ëª…ì‹œì ìœ¼ë¡œ ìƒì„±ë˜ì§€ ì•Šê±°ë‚˜ êµ¬ì¡°ì ìœ¼ë¡œ ì˜ëª» ìƒì„±ë¨
2. ì¿ ë‘ì™€ ê°™ì€ ë°°í¬ ë„êµ¬ëŠ” ZIP íŒŒì¼ ë‚´ ë£¨íŠ¸ ê²½ë¡œì— íŒŒì¼ì´ ìˆì–´ì•¼ í•˜ëŠ”ë°, `build/` ë‚´ë¶€ì— ì¤‘ì²©ë˜ëŠ” ë¬¸ì œ ë°œìƒ
3. ë¶ˆí•„ìš”í•œ `deploy.zip` íŒŒì¼ì´ ê°„í˜¹ ìƒì„±ë˜ì–´ í˜¼ë€ ì•¼ê¸°

## ğŸ› ï¸ ê°œì„  ë‚´ìš©

### 1. ëª…ì‹œì  ZIP íŒŒì¼ ìƒì„± êµ¬ë¬¸ ê°œì„ 

**ë³€ê²½ ì „**:
```yaml
echo "Creating build.zip for direct deployment verification..."
cd build && zip -r ../build.zip * && cd ..
```

**ë³€ê²½ í›„**:
```yaml
# deploy.zipì´ ìˆìœ¼ë©´ ì œê±° (ë¶ˆí•„ìš”í•œ íŒŒì¼ ì •ë¦¬)
if [ -f "deploy.zip" ]; then
  echo "ğŸ”„ Removing unnecessary deploy.zip file"
  rm -f deploy.zip
fi

# build.zip ëª…ì‹œì  ìƒì„± - build/ í´ë” ë‚´ìš©ë§Œ ë£¨íŠ¸ì— ì••ì¶•
echo "ğŸ”„ Creating build.zip with the correct structure..."
cd build && zip -r ../build.zip * && cd ..

# zip íŒŒì¼ ì¡´ì¬ ê²€ì¦
if [ ! -f "build.zip" ]; then
  echo "::error::build.zip file was not created. Deployment will fail."
  exit 1
fi

# zip íŒŒì¼ í¬ê¸° ê²€ì¦
ZIP_SIZE_BYTES=$(du -b build.zip | cut -f1)
if [ "$ZIP_SIZE_BYTES" -lt 1000 ]; then
  echo "::error::build.zip is too small (${ZIP_SIZE_BYTES} bytes). The compression likely failed."
  exit 1
fi
```

### 2. í–¥ìƒëœ ZIP êµ¬ì¡° ê²€ì¦ ì ˆì°¨ ì¶”ê°€

**ë³€ê²½ ì „**: ê¸°ì¡´ì—ëŠ” ê°„ë‹¨í•œ íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ë§Œ í™•ì¸í•˜ê³  ê²½ê³  í‘œì‹œ

**ë³€ê²½ í›„**: ì—„ê²©í•œ êµ¬ì¡° ê²€ì¦ìœ¼ë¡œ ë°°í¬ ì „ ì‹¤íŒ¨ ê°ì§€
```yaml
- name: Strict ZIP structure verification
  run: |
    echo "Running strict ZIP structure verification..."
    
    # ì¤‘ìš” íŒŒì¼ë“¤ì´ ë£¨íŠ¸ì— ì§ì ‘ ìˆëŠ”ì§€ í™•ì¸
    echo "Checking zip file structure..."
    if unzip -l build.zip | grep -q "build/"; then
      echo "::error::ZIP file contains nested 'build/' directory. The structure is incorrect."
      echo "Current ZIP structure (showing nested paths):"
      unzip -l build.zip | grep "build/"
      exit 1
    fi
    
    # í•µì‹¬ íŒŒì¼ë“¤ ë£¨íŠ¸ ë ˆë²¨ ê²€ì¦
    echo "Checking for essential files at the root level..."
    MISSING_FILES=0
    
    if ! unzip -l build.zip | grep -q "index.html"; then
      echo "::error::index.html not found at zip root"
      MISSING_FILES=$((MISSING_FILES+1))
    else
      echo "âœ… index.html found at zip root"
    fi
    
    # ì¶”ê°€ íŒŒì¼ ê²€ì¦...
```

### 3. ì£¼ìš” ê°œì„  ì‚¬í•­

1. **ëª…í™•í•œ ì••ì¶• ê·œì¹™ ì ìš©**:
   - `build/` í´ë” ë‚´ íŒŒì¼ë“¤ë§Œ ì„ íƒí•˜ì—¬ ë£¨íŠ¸ì— ì••ì¶•
   - `cd build && zip -r ../build.zip * && cd ..` ëª…ë ¹ìœ¼ë¡œ ì˜¬ë°”ë¥¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° ë³´ì¥

2. **fail-fast ê²€ì¦**:
   - ZIP íŒŒì¼ ìì²´ ìƒì„± ì—¬ë¶€ ê²€ì¦
   - ZIP íŒŒì¼ ìµœì†Œ í¬ê¸° ê²€ì¦
   - í•„ìˆ˜ íŒŒì¼ ì¡´ì¬ ê²€ì¦
   - ì¤‘ì²©ëœ `build/` ê²½ë¡œ ì—†ëŠ”ì§€ ê²€ì¦

3. **ë¶ˆí•„ìš” íŒŒì¼ ì •ë¦¬**:
   - `deploy.zip` ê°™ì€ ë¶ˆí•„ìš” íŒŒì¼ ìë™ ì œê±°
   - í˜¼ë€ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ëª…í™•í•œ ë¡œê¹… ë©”ì‹œì§€ ì¶”ê°€

## âœ… ì ìš© ê²°ê³¼

### 1. ZIP íŒŒì¼ ìƒì„± ê²°ê³¼

GitHub Actions ë¡œê·¸ì—ì„œ í™•ì¸ëœ ê²°ê³¼:

```
ğŸ”„ Creating build.zip with the correct structure...
  adding: asset-manifest.json (deflated 71%)
  adding: favicon.ico (deflated 56%)
  adding: health (stored 0%)
  adding: health.html (deflated 20%)
  adding: index.html (deflated 73%)
  adding: logo192.png (deflated 0%)
  ...
âœ… Build content verified and archived for deployment.
build.zip details:
680K    build.zip
```

### 2. ZIP êµ¬ì¡° ê²€ì¦ ê²°ê³¼

```
Running strict ZIP structure verification...
Checking zip file structure...
Checking for essential files at the root level...
âœ… index.html found at zip root
âœ… static/ directory found at zip root
âœ… favicon.ico found at zip root
âœ… ZIP structure verification passed! The build.zip file is ready for deployment.
```

### 3. ë°°í¬ ê²°ê³¼

```
HTTP response code: 202
âœ… Deployment successful with HTTP status code: 202

Files in /site/wwwroot:
index.html
static
favicon.ico
manifest.json
...
```

## ğŸ”„ ì „ì²´ ì›Œí¬í”Œë¡œìš° ê°œì„  íš¨ê³¼

ì´ë²ˆ ê°œì„ ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ íš¨ê³¼ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤:

1. **ì˜¬ë°”ë¥¸ êµ¬ì¡°ì˜ ZIP íŒŒì¼ ë³´ì¥**:
   - Azure App Service ì›¹ ë£¨íŠ¸(`/site/wwwroot`)ì— íŒŒì¼ì´ ì˜¬ë°”ë¥¸ êµ¬ì¡°ë¡œ ë°°í¬ë¨
   - ì¤‘ì²©ëœ `build/` í´ë” ë¬¸ì œ ë°©ì§€

2. **ëª…í™•í•œ ë°°í¬ ì‹¤íŒ¨ ê°ì§€**:
   - ì˜ëª»ëœ ZIP êµ¬ì¡°ëŠ” ë°°í¬ ì‹œë„ ì „ì— ì›Œí¬í”Œë¡œìš°ë¥¼ ì¤‘ë‹¨ì‹œí‚´
   - ì‹¤íŒ¨ ì›ì¸ì„ ëª…í™•íˆ í‘œì‹œí•˜ì—¬ ë””ë²„ê¹… ìš©ì´ì„± í–¥ìƒ

3. **ì¼ê´€ëœ ë°°í¬ íŒ¨í„´ í™•ë¦½**:
   - í•­ìƒ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ZIP íŒŒì¼ ìƒì„±
   - ì—¬ëŸ¬ ê°€ì§€ ì••ì¶• íŒŒì¼ ëŒ€ì‹  ë‹¨ì¼ `build.zip` ì‚¬ìš©ìœ¼ë¡œ í˜¼ë€ ë°©ì§€

## ğŸ“Š ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­

ì´ë²ˆ ìˆ˜ì •ì„ í†µí•´ Azure ë°°í¬ìš© ZIP íŒŒì¼ì˜ ìƒì„±ê³¼ êµ¬ì¡°ê°€ ì•ˆì •í™”ë˜ì—ˆìŠµë‹ˆë‹¤. í–¥í›„ ë‹¤ìŒ ì‚¬í•­ì„ ê¶Œì¥í•©ë‹ˆë‹¤:

1. **ìë™í™”ëœ ZIP êµ¬ì¡° í…ŒìŠ¤íŠ¸**:
   - ìƒˆ ê¸°ëŠ¥ ê°œë°œ ì‹œ í•­ìƒ ZIP êµ¬ì¡° ê²€ì¦ ìœ ì§€
   - ë¹Œë“œ ì¶œë ¥ êµ¬ì¡° ë³€ê²½ ì‹œ ê²€ì¦ ë¡œì§ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸

2. **ë°°í¬ íŒ¨í„´ í‘œì¤€í™”**:
   - ëª¨ë“  Azure ë°°í¬ í”„ë¡œì íŠ¸ì— ë™ì¼í•œ ZIP ìƒì„± íŒ¨í„´ ì ìš©
   - ê°œë°œì ê°„ ì¼ê´€ëœ ë°°í¬ ê°€ì´ë“œë¼ì¸ ê³µìœ 

3. **ëª¨ë‹ˆí„°ë§ ê°•í™”**:
   - ë°°í¬ ê³¼ì •ì—ì„œ ZIP íŒŒì¼ í¬ê¸°ì™€ ë‚´ìš©ë¬¼ ë³€í™” ì¶”ì 
   - íŠ¹ì´ íŒ¨í„´ ë°œê²¬ ì‹œ ìë™ ì•Œë¦¼ ì„¤ì • ê³ ë ¤ 