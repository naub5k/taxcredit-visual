# Git 자동 배포 복구 작업 보고서

**요청 날짜**: 2025-04-30
**완료 날짜**: 2025-04-30
**프로젝트**: taxcredit_mobileapp
**요청자**: 유비님

## 요청 사항

기존에 구성된 `git push azure HEAD:master` 기반 **Azure App Service 기본 Git 자동 배포 방식으로 복구** 요청

## 문제 원인 분석

1. **Git 명령어 실행 불가 문제**:
   - Cursor 환경에서 git 명령어가 직접 실행되지 않음
   - `git: 'C:\Program Files\Git\bin\git.exe' 용어가 cmdlet, 함수, 스크립트 파일 또는 실행할 수 있는 프로그램 이름으로 인식되지 않습니다.` 오류 발생

2. **FTP 배포 방식의 문제점**:
   - 경로 오류 및 인증 문제 발생
   - 복잡한 배포 과정으로 인한 관리 난이도 증가

3. **이전 대응의 문제점**:
   - Git 명령어가 실행되지 않는 상황에서 FTP 방식으로 우회하려 시도
   - Azure App Service의 기본 Git 배포 기능 활용하지 못함

## 작업 내용

1. **Git 명령어 자동 탐지 스크립트 개발**:
   - PowerShell에서 Git 실행 파일 경로 자동 탐지 기능 구현
   - 여러 표준 설치 경로를 검색하여 Git 실행 파일 찾기
   - Git 래퍼 함수(Invoke-Git)를 통해 명령 실행 안정성 확보

2. **배포 스크립트 개발**:
   - `setup-git-deploy.ps1`: Git 원격 저장소(remote) 설정 스크립트
   - `git-deploy.ps1`: 빌드-커밋-배포 자동화 스크립트
   - 문제 발생 시 상세한 진단 메시지 제공

3. **package.json에 배포 스크립트 등록**:
   ```json
   "scripts": {
     "git-deploy": "powershell -ExecutionPolicy Bypass -File ..\\git-deploy.ps1",
     "setup-git-deploy": "powershell -ExecutionPolicy Bypass -File ..\\setup-git-deploy.ps1"
   }
   ```

4. **상세 문서화**:
   - `GIT_DEPLOY_GUIDE.md` 작성: 배포 방법 및 문제 해결 가이드 제공
   - 요구사항에 맞게 기존 remote URL 적용: 
     `https://taxcredit-visual\naub5k@taxcredit-visual.scm.azurewebsites.net:443/taxcredit-visual.git`

## 배포 방법

### 1. Git 설정

```powershell
cd taxcredit_mobileapp
.\setup-git-deploy.ps1
```

또는 npm 스크립트 사용:
```powershell
cd taxcredit_mobileapp\my-app
npm run setup-git-deploy
```

### 2. 앱 빌드 및 배포

```powershell
cd taxcredit_mobileapp
.\git-deploy.ps1
```

또는 npm 스크립트 사용:
```powershell
cd taxcredit_mobileapp\my-app
npm run git-deploy
```

### 3. 수동 배포 (스크립트 사용 없이)

```powershell
cd taxcredit_mobileapp\my-app
npm run build
git add .
git commit -m "배포용 커밋"
git push azure HEAD:master
```

## 해결된 문제점

1. **Git 명령어 실행 문제**:
   - Git 실행 파일 경로가 환경 변수에 없어도 자동 탐지하여 실행
   - PowerShell을 통한 안정적인 Git 명령 실행

2. **배포 과정 간소화**:
   - 단일 명령어(`npm run git-deploy`)로 빌드-커밋-배포 모두 처리
   - 사용자 확인 단계를 통한 안전한 배포 과정

3. **FTP 의존성 제거**:
   - Azure App Service의 기본 Git 배포 기능 활용
   - 경로 오류 및 인증 문제 해결

## 향후 권장 사항

1. **Git 환경 구성**:
   - Git을 표준 경로에 설치하고 환경 변수에 추가하면 더 안정적인 작업 가능
   - 주요 설치 경로: `C:\Program Files\Git\bin\git.exe`

2. **배포 자동화 확장**:
   - CI/CD 파이프라인 구축 고려
   - GitHub Actions 또는 Azure DevOps와 연동 가능

3. **문제 발생 시 대응 방법**:
   - 배포 실패 시 스크립트가 제공하는 상세 오류 메시지 참고
   - `GIT_DEPLOY_GUIDE.md` 문서의 문제 해결 섹션 참고

## 결론

이번 작업을 통해 Azure App Service의 Git 기반 자동 배포 기능을 복구하였습니다. 특히 Cursor 환경에서 Git 명령어가 직접 실행되지 않는 문제를 PowerShell 스크립트를 통해 우회하여 해결했습니다. 이제 단일 명령어(`npm run git-deploy`)만으로 애플리케이션을 빌드하고 Azure에 배포할 수 있게 되어 개발 및 배포 과정이 크게 간소화되었습니다. 